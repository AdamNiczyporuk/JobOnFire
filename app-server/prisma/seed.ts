import { ApplicationStatus, MeetingType, Prisma, PrismaClient, UserRole } from "@prisma/client";
import bcrypt from "bcrypt";

const prisma = new PrismaClient();

type AdditionalEmployerSeed = {
  user: {
    email: string;
    username: string;
  };
  profile: {
    companyName: string;
    companyImageUrl?: string;
    industry: string[];
    description?: string;
    contractTypes: string[];
    contactPhone?: string;
    contactEmail?: string;
    benefits: string[];
  };
  locations: Array<{
    city: string;
    state?: string;
    street?: string;
    postalCode?: string;
    latitude?: number;
    longtitude?: number;
  }>;
  offers: Array<{
    name: string;
    description: string;
    jobLevel: string[];
    contractType: string;
    salary?: string;
    workingMode: string[];
    workload?: string;
    responsibilities: string[];
    requirements: string[];
    whatWeOffer: string[];
    applicationUrl?: string | null;
    tags: string[];
    expireInDays: number;
    locationIndex?: number;
  }>;
};

async function main(): Promise<void> {
  console.info("üå± Seeding database with demo data...");

  // Clean up old seed data before re-seeding
  console.info("üßπ Cleaning previous seed data...");
  await prisma.candidateAnswer.deleteMany();
  await prisma.applicationResponse.deleteMany();
  await prisma.meeting.deleteMany();
  await prisma.applicationForJobOffer.deleteMany();
  await prisma.recruitmentQuestion.deleteMany();
  await prisma.jobOffer.deleteMany();
  await prisma.lokalizationToEmployerProfile.deleteMany();
  await prisma.employerProfile.deleteMany();
  await prisma.candidateCV.deleteMany();
  await prisma.profileLink.deleteMany();
  await prisma.candidateProfile.deleteMany();
  await prisma.lokalization.deleteMany();
  await prisma.user.deleteMany({ where: { email: { endsWith: "@jobonfire.com" } } });
  console.info("‚úÖ Cleanup complete");

  const [employerPasswordHash, candidatePasswordHash] = await Promise.all([
    bcrypt.hash("Employer123!", 10),
    bcrypt.hash("Candidate123!", 10),
  ]);

  const employerUser = await prisma.user.upsert({
    where: { email: "employer@jobonfire.com" },
    update: {
      username: "firetech",
      isDeleted: false,
    },
    create: {
      username: "firetech",
      email: "employer@jobonfire.com",
      passwordHash: employerPasswordHash,
      role: UserRole.EMPLOYER,
      registerDate: new Date(),
      isDeleted: false,
    },
  });

  const industry: Prisma.JsonArray = ["Software", "IT Services"];
  const contractTypes: Prisma.JsonArray = ["Umowa o pracƒô", "B2B"];
  const benefits: Prisma.JsonArray = [
    "Prywatna opieka medyczna",
    "Bud≈ºet szkoleniowy",
    "Praca hybrydowa",
    "Karta sportowa",
  ];

  const employerProfile = await prisma.employerProfile.upsert({
    where: { userId: employerUser.id },
    update: {
      companyName: "FireTech Software",
      companyImageUrl: "https://cdn.jobonfire.dev/logos/firetech.png",
      industry,
      description:
        "Nowoczesny software house budujƒÖcy aplikacje webowe i mobilne dla bran≈ºy fintech, e-commerce oraz HR.",
      contractType: contractTypes,
      contactPhone: "+48 511 223 344",
      contactEmail: "hr@firetech.pl",
      benefits,
    },
    create: {
      companyName: "FireTech Software",
      companyImageUrl: "https://cdn.jobonfire.dev/logos/firetech.png",
      industry,
      description:
        "Nowoczesny software house budujƒÖcy aplikacje webowe i mobilne dla bran≈ºy fintech, e-commerce oraz HR.",
      contractType: contractTypes,
      contactPhone: "+48 511 223 344",
      contactEmail: "hr@firetech.pl",
      benefits,
      userId: employerUser.id,
    },
  });

  let warsawOffice = await prisma.lokalization.findFirst({
    where: {
      city: "Warszawa",
      state: "Mazowieckie",
      street: "Prosta 51",
      postalCode: "00-838",
    },
  });

  if (!warsawOffice) {
    warsawOffice = await prisma.lokalization.create({
      data: {
        city: "Warszawa",
        state: "Mazowieckie",
        street: "Prosta 51",
        postalCode: "00-838",
        latitude: 52.2318,
        longtitude: 20.9965,
      },
    });
  }

  await prisma.lokalizationToEmployerProfile.upsert({
    where: {
      employerProfileId_lokalizationId: {
        employerProfileId: employerProfile.id,
        lokalizationId: warsawOffice.id,
      },
    },
    update: {},
    create: {
      employerProfileId: employerProfile.id,
      lokalizationId: warsawOffice.id,
    },
  });

  const jobLevels: Prisma.JsonArray = ["Mid", "Senior"];
  const workingModes: Prisma.JsonArray = ["Hybrydowa", "Zdalna"];
  const responsibilities: Prisma.JsonArray = [
    "Rozw√≥j i utrzymanie aplikacji frontendowych w oparciu o Next.js i TypeScript",
    "≈öcis≈Ça wsp√≥≈Çpraca z zespo≈Çem UX/UI oraz backend",
    "Dbanie o jako≈õƒá kodu i pokrycie testami automatycznymi",
    "Optymalizacja wydajno≈õciowo-SEO istniejƒÖcych modu≈Ç√≥w",
  ];
  const requirements: Prisma.JsonArray = [
    "Min. 3 lata do≈õwiadczenia komercyjnego w React/Next.js",
    "Bardzo dobra znajomo≈õƒá TypeScript",
    "Umiejƒôtno≈õƒá pracy z REST API i GraphQL",
    "Do≈õwiadczenie z testami (Jest, React Testing Library)",
    "Znajomo≈õƒá narzƒôdzi CI/CD (GitHub Actions, Docker)",
  ];
  const offerWhatWeProvide: Prisma.JsonArray = [
    "Wynagrodzenie 18 000 - 24 000 PLN netto + VAT",
    "Bud≈ºet szkoleniowy 5 000 PLN rocznie",
    "Nowoczesne biuro w centrum Warszawy",
    "Elastyczne godziny pracy oraz mo≈ºliwo≈õƒá pracy zdalnej",
  ];
  const offerTags: Prisma.JsonArray = ["React", "Next.js", "TypeScript", "CI/CD", "GraphQL"];

  let frontendOffer = await prisma.jobOffer.findFirst({
    where: {
      name: "Frontend Developer (React/Next.js)",
      employerProfileId: employerProfile.id,
    },
  });

  if (!frontendOffer) {
    frontendOffer = await prisma.jobOffer.create({
      data: {
        name: "Frontend Developer (React/Next.js)",
        description:
          "Do≈ÇƒÖcz do zespo≈Çu FireTech Software i rozwijaj rozwiƒÖzania webowe dla klient√≥w z ca≈Çego ≈õwiata. Szukamy osoby, kt√≥ra kocha czysty kod, automatyzacjƒô i ≈õledzenie najnowszych trend√≥w frontendowych.",
        jobLevel: jobLevels,
        contractType: "B2B",
        salary: "18 000 - 24 000 PLN netto (B2B)",
        createDate: new Date(),
        expireDate: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000),
        workingMode: workingModes,
        workload: "Pe≈Çny etat",
        responsibilities,
        requirements,
        whatWeOffer: offerWhatWeProvide,
        applicationUrl: null,
        tags: offerTags,
        isActive: true,
        lokalizationId: warsawOffice.id,
        employerProfileId: employerProfile.id,
      },
    });
  } else {
    frontendOffer = await prisma.jobOffer.update({
      where: { id: frontendOffer.id },
      data: {
        description:
          "Do≈ÇƒÖcz do zespo≈Çu FireTech Software i rozwijaj rozwiƒÖzania webowe dla klient√≥w z ca≈Çego ≈õwiata. Szukamy osoby, kt√≥ra kocha czysty kod, automatyzacjƒô i ≈õledzenie najnowszych trend√≥w frontendowych.",
        jobLevel: jobLevels,
        workingMode: workingModes,
        responsibilities,
        requirements,
        whatWeOffer: offerWhatWeProvide,
        tags: offerTags,
        salary: "18 000 - 24 000 PLN netto (B2B)",
        isActive: true,
        expireDate: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000),
      },
    });
  }

  const questionTexts = [
    "Opisz swoje najwiƒôksze wyzwanie projektowe zwiƒÖzane z wydajno≈õciƒÖ frontendu.",
    "Jakie narzƒôdzia wykorzystujesz do monitorowania jako≈õci i stabilno≈õci aplikacji React?",
  ];

  for (const text of questionTexts) {
    const existingQuestion = await prisma.recruitmentQuestion.findFirst({
      where: {
        jobOfferId: frontendOffer.id,
        question: text,
      },
    });


  const additionalEmployers: AdditionalEmployerSeed[] = [
    {
      user: {
        email: "employer.analytics@jobonfire.com",
        username: "dataforge",
      },
      profile: {
        companyName: "DataForge Analytics",
        companyImageUrl: "https://cdn.jobonfire.dev/logos/dataforge.png",
        industry: ["Analityka danych", "Cloud"],
        description:
          "Tworzymy rozwiƒÖzania analityczne w oparciu o Azure i ekosystem danych. Wspieramy klient√≥w w budowie hurtowni danych i platform BI.",
        contractTypes: ["Umowa o pracƒô", "B2B"],
        contactPhone: "+48 600 112 233",
        contactEmail: "kariera@dataforge.pl",
        benefits: [
          "Bud≈ºet konferencyjny",
          "Elastyczne godziny pracy",
          "Ubezpieczenie na ≈ºycie",
          "Program mentorski",
        ],
      },
      locations: [
        {
          city: "Krak√≥w",
          state: "Ma≈Çopolskie",
          street: "Lubicz 17G",
          postalCode: "31-503",
          latitude: 50.0665,
          longtitude: 19.9601,
        },
      ],
      offers: [
        {
          name: "Data Engineer (Azure)",
          description:
            "Poszukujemy Data Engineera do zespo≈Çu projektujƒÖcego i wdra≈ºajƒÖcego rozwiƒÖzania danych na platformie Azure.",
          jobLevel: ["Mid", "Senior"],
          contractType: "B2B",
          salary: "20 000 - 26 000 PLN netto (B2B)",
          workingMode: ["Hybrydowa"],
          workload: "Pe≈Çny etat",
          responsibilities: [
            "Projektowanie i implementacja pipeline'√≥w danych w Azure Data Factory i Databricks",
            "Modelowanie hurtowni danych i optymalizacja zapyta≈Ñ SQL",
            "Automatyzacja proces√≥w CI/CD dla rozwiƒÖza≈Ñ danych",
          ],
          requirements: [
            "Min. 3 lata do≈õwiadczenia w projektach danych",
            "Bardzo dobra znajomo≈õƒá Azure Data Platform",
            "Umiejƒôtno≈õƒá programowania w Python lub Scala",
            "Praktyczna znajomo≈õƒá narzƒôdzi CI/CD",
          ],
          whatWeOffer: [
            "Praca z miƒôdzynarodowymi klientami",
            "Bud≈ºet szkoleniowy 6 000 PLN rocznie",
            "Mo≈ºliwo≈õƒá pracy z najnowszym stackiem Azure",
          ],
          applicationUrl: null,
          tags: ["Azure", "Data Lake", "PySpark", "SQL"],
          expireInDays: 60,
        },
        {
          name: "BI Developer (Power BI)",
          description:
            "Szukamy osoby, kt√≥ra pomo≈ºe nam budowaƒá interaktywne raporty i dashboardy Power BI dla klient√≥w z bran≈ºy retail.",
          jobLevel: ["Mid"],
          contractType: "Umowa o pracƒô",
          salary: "16 000 - 19 000 PLN brutto",
          workingMode: ["Hybrydowa"],
          workload: "Pe≈Çny etat",
          responsibilities: [
            "Projektowanie modeli danych w Power BI",
            "Tworzenie raport√≥w i dashboard√≥w",
            "Optymalizacja istniejƒÖcych rozwiƒÖza≈Ñ i wsparcie u≈ºytkownik√≥w biznesowych",
          ],
          requirements: [
            "Do≈õwiadczenie w pracy z Power BI i DAX",
            "Bardzo dobra znajomo≈õƒá SQL",
            "Znajomo≈õƒá proces√≥w ETL",
          ],
          whatWeOffer: [
            "Stabilna wsp√≥≈Çpraca i jasna ≈õcie≈ºka rozwoju",
            "Prywatna opieka medyczna i karta sportowa",
            "Zesp√≥≈Ç ekspert√≥w gotowych dzieliƒá siƒô wiedzƒÖ",
          ],
          applicationUrl: null,
          tags: ["Power BI", "DAX", "SQL"],
          expireInDays: 45,
        },
      ],
    },
    {
      user: {
        email: "employer.cloud@jobonfire.com",
        username: "cloudops",
      },
      profile: {
        companyName: "CloudOps Solutions",
        companyImageUrl: "https://cdn.jobonfire.dev/logos/cloudops.png",
        industry: ["DevOps", "Infrastruktura"],
        description:
          "Specjalizujemy siƒô w automatyzacji infrastruktury i zapewnianiu niezawodno≈õci system√≥w krytycznych w architekturze chmurowej.",
        contractTypes: ["B2B"],
        contactPhone: "+48 722 443 990",
        contactEmail: "jobs@cloudops.solutions",
        benefits: [
          "Sprzƒôt do wyboru",
          "Pakiet medyczny",
          "Hackathony wewnƒôtrzne",
          "Bud≈ºet certyfikacyjny AWS/GCP",
        ],
      },
      locations: [
        {
          city: "Wroc≈Çaw",
          state: "Dolno≈õlƒÖskie",
          street: "Plac Grunwaldzki 23",
          postalCode: "50-377",
          latitude: 51.1101,
          longtitude: 17.0603,
        },
        {
          city: "Gda≈Ñsk",
          state: "Pomorskie",
          street: "Marynarki Polskiej 96",
          postalCode: "80-557",
          latitude: 54.3953,
          longtitude: 18.6400,
        },
      ],
      offers: [
        {
          name: "DevOps Engineer (AWS)",
          description:
            "Do≈ÇƒÖcz do zespo≈Çu odpowiedzialnego za tworzenie i utrzymanie infrastruktury AWS dla klient√≥w z bran≈ºy e-commerce.",
          jobLevel: ["Senior"],
          contractType: "B2B",
          salary: "24 000 - 30 000 PLN netto (B2B)",
          workingMode: ["Zdalna"],
          workload: "Pe≈Çny etat",
          responsibilities: [
            "Projektowanie i wdra≈ºanie infrastruktury jako kod (Terraform)",
            "Automatyzacja proces√≥w CI/CD oraz monitoringu",
            "Wsp√≥≈Çpraca z zespo≈Çami developerskimi w zakresie dobrych praktyk DevOps",
          ],
          requirements: [
            "Bardzo dobra znajomo≈õƒá AWS",
            "Do≈õwiadczenie z Kubernetes i Terraform",
            "Znajomo≈õƒá narzƒôdzi observability (Prometheus, Grafana)",
          ],
          whatWeOffer: [
            "W 100% zdalna wsp√≥≈Çpraca",
            "Elastyczne godziny i brak nadgodzin",
            "Bud≈ºet na certyfikacje AWS",
          ],
          applicationUrl: null,
          tags: ["AWS", "Terraform", "Kubernetes"],
          expireInDays: 50,
          locationIndex: 0,
        },
        {
          name: "Site Reliability Engineer",
          description:
            "SRE odpowiedzialny za niezawodno≈õƒá platform SaaS o globalnym zasiƒôgu. Praca z kulturƒÖ bliskƒÖ zespo≈Çom produktowym.",
          jobLevel: ["Mid", "Senior"],
          contractType: "B2B",
          salary: "22 000 - 28 000 PLN netto (B2B)",
          workingMode: ["Zdalna", "Hybrydowa"],
          workload: "Pe≈Çny etat",
          responsibilities: [
            "Projektowanie proces√≥w SLO/SLA oraz automatyzacji runbook√≥w",
            "Budowa narzƒôdzi poprawiajƒÖcych obserwowalno≈õƒá",
            "Analiza incydent√≥w i ciƒÖg≈Çe doskonalenie platformy",
          ],
          requirements: [
            "Do≈õwiadczenie w rolach SRE/DevOps",
            "Znajomo≈õƒá jƒôzyka Python lub Go",
            "Praktyka w pracy z narzƒôdziami observability",
          ],
          whatWeOffer: [
            "Dwutygodniowe sprinty R&D",
            "Pakiet benefit√≥w dopasowany indywidualnie",
            "Wyjazdy integracyjne w Europie",
          ],
          applicationUrl: null,
          tags: ["SRE", "Observability", "Python"],
          expireInDays: 55,
          locationIndex: 1,
        },
      ],
    },
  ];

  for (const employerData of additionalEmployers) {
    const employerUserSeed = await prisma.user.upsert({
      where: { email: employerData.user.email },
      update: {
        username: employerData.user.username,
        passwordHash: employerPasswordHash,
        isDeleted: false,
      },
      create: {
        username: employerData.user.username,
        email: employerData.user.email,
        passwordHash: employerPasswordHash,
        role: UserRole.EMPLOYER,
        registerDate: new Date(),
        isDeleted: false,
      },
    });

    const employerProfileSeed = await prisma.employerProfile.upsert({
      where: { userId: employerUserSeed.id },
      update: {
        companyName: employerData.profile.companyName,
        companyImageUrl: employerData.profile.companyImageUrl,
        industry: employerData.profile.industry as Prisma.JsonArray,
        description: employerData.profile.description,
        contractType: employerData.profile.contractTypes as Prisma.JsonArray,
        contactPhone: employerData.profile.contactPhone,
        contactEmail: employerData.profile.contactEmail,
        benefits: employerData.profile.benefits as Prisma.JsonArray,
      },
      create: {
        companyName: employerData.profile.companyName,
        companyImageUrl: employerData.profile.companyImageUrl,
        industry: employerData.profile.industry as Prisma.JsonArray,
        description: employerData.profile.description,
        contractType: employerData.profile.contractTypes as Prisma.JsonArray,
        contactPhone: employerData.profile.contactPhone,
        contactEmail: employerData.profile.contactEmail,
        benefits: employerData.profile.benefits as Prisma.JsonArray,
        userId: employerUserSeed.id,
      },
    });

    const locationIds: number[] = [];
    for (const location of employerData.locations) {
      let locationRecord = await prisma.lokalization.findFirst({
        where: {
          city: location.city,
          state: location.state,
          street: location.street,
          postalCode: location.postalCode,
        },
      });

      if (!locationRecord) {
        locationRecord = await prisma.lokalization.create({
          data: {
            city: location.city,
            state: location.state,
            street: location.street,
            postalCode: location.postalCode,
            latitude: location.latitude,
            longtitude: location.longtitude,
          },
        });
      }

      locationIds.push(locationRecord.id);

      await prisma.lokalizationToEmployerProfile.upsert({
        where: {
          employerProfileId_lokalizationId: {
            employerProfileId: employerProfileSeed.id,
            lokalizationId: locationRecord.id,
          },
        },
        update: {},
        create: {
          employerProfileId: employerProfileSeed.id,
          lokalizationId: locationRecord.id,
        },
      });
    }

    for (const offer of employerData.offers) {
      const targetLocationId = locationIds[offer.locationIndex ?? 0] ?? null;
      const existingOffer = await prisma.jobOffer.findFirst({
        where: {
          employerProfileId: employerProfileSeed.id,
          name: offer.name,
        },
      });

      const offerData = {
        description: offer.description,
        jobLevel: offer.jobLevel as Prisma.JsonArray,
        contractType: offer.contractType,
        salary: offer.salary ?? null,
        workingMode: offer.workingMode as Prisma.JsonArray,
        workload: offer.workload ?? null,
        responsibilities: offer.responsibilities as Prisma.JsonArray,
        requirements: offer.requirements as Prisma.JsonArray,
        whatWeOffer: offer.whatWeOffer as Prisma.JsonArray,
        applicationUrl: offer.applicationUrl ?? null,
        tags: offer.tags as Prisma.JsonArray,
        isActive: true,
        expireDate: new Date(Date.now() + offer.expireInDays * 24 * 60 * 60 * 1000),
        lokalizationId: targetLocationId,
      };

      if (!existingOffer) {
        await prisma.jobOffer.create({
          data: {
            name: offer.name,
            createDate: new Date(),
            employerProfileId: employerProfileSeed.id,
            ...offerData,
          },
        });
      } else {
        await prisma.jobOffer.update({
          where: { id: existingOffer.id },
          data: offerData,
        });
      }
    }
  }
    if (!existingQuestion) {
      await prisma.recruitmentQuestion.create({
        data: {
          jobOfferId: frontendOffer.id,
          question: text,
        },
      });
    }
  }

  const candidateUser = await prisma.user.upsert({
    where: { email: "candidate@jobonfire.com" },
    update: {
      username: "frontendhero",
      isDeleted: false,
    },
    create: {
      username: "frontendhero",
      email: "candidate@jobonfire.com",
      passwordHash: candidatePasswordHash,
      role: UserRole.CANDIDATE,
      registerDate: new Date(),
      isDeleted: false,
    },
  });

  const skills: Prisma.JsonArray = [
    { name: "React", level: "EXPERT" },
    { name: "Next.js", level: "EXPERT" },
    { name: "TypeScript", level: "ADVANCED" },
    { name: "GraphQL", level: "ADVANCED" },
    { name: "Jest", level: "ADVANCED" },
  ];
  const experience: Prisma.JsonArray = [
    {
      company: "CodeWave",
      position: "Frontend Developer",
      from: "2021-02-01",
      to: "2023-07-31",
      responsibilities: [
        "Implementacja modu≈Ç√≥w w React i Next.js",
        "Wsp√≥≈Çpraca z zespo≈Çem backendowym przy projektowaniu API",
        "Tworzenie test√≥w jednostkowych i integracyjnych",
      ],
    },
    {
      company: "BrightApps",
      position: "Junior Frontend Developer",
      from: "2019-05-01",
      to: "2021-01-31",
      responsibilities: [
        "Budowa komponent√≥w UI",
        "Optymalizacja wydajno≈õci komponent√≥w",
      ],
    },
  ];
  const education: Prisma.JsonArray = [
    {
      school: "Politechnika Warszawska",
      field: "Informatyka",
      degree: "Magister",
      graduationYear: 2019,
    },
  ];

  const candidateProfile = await prisma.candidateProfile.upsert({
    where: { userId: candidateUser.id },
    update: {
      name: "Anna",
      lastName: "Nowak",
      description:
        "Frontend Developer z 5-letnim do≈õwiadczeniem w budowaniu aplikacji webowych. Specjalizujƒô siƒô w ekosystemie React i stale poszukujƒô przestrzeni do automatyzacji i usprawniania proces√≥w.",
      birthday: new Date("1994-08-14"),
      experience,
      phoneNumber: 481112233,
      skills,
      place: "Warszawa",
      education,
    },
    create: {
      name: "Anna",
      lastName: "Nowak",
      description:
        "Frontend Developer z 5-letnim do≈õwiadczeniem w budowaniu aplikacji webowych. Specjalizujƒô siƒô w ekosystemie React i stale poszukujƒô przestrzeni do automatyzacji i usprawniania proces√≥w.",
      birthday: new Date("1994-08-14"),
      experience,
      phoneNumber: 481112233,
      skills,
      place: "Warszawa",
      education,
      userId: candidateUser.id,
    },
  });

  const cvJson = JSON.stringify({
    summary:
      "Do≈õwiadczona frontend developerka, kt√≥ra ≈ÇƒÖczy ≈õwietne oko do detalu z zami≈Çowaniem do automatyzacji i test√≥w.",
    skills,
    experience,
    education,
  });

  let candidateCv = await prisma.candidateCV.findFirst({
    where: {
      candidateProfileId: candidateProfile.id,
      name: "Frontend CV",
    },
  });

  if (!candidateCv) {
    candidateCv = await prisma.candidateCV.create({
      data: {
        name: "Frontend CV",
        cvJson,
        candidateProfileId: candidateProfile.id,
      },
    });
  } else {
    candidateCv = await prisma.candidateCV.update({
      where: { id: candidateCv.id },
      data: {
        cvJson,
      },
    });
  }

  const existingProfileLink = await prisma.profileLink.findFirst({
    where: {
      candidateProfileId: candidateProfile.id,
      url: "https://github.com/frontendhero",
    },
  });

  if (!existingProfileLink) {
    await prisma.profileLink.create({
      data: {
        name: "GitHub",
        url: "https://github.com/frontendhero",
        candidateProfileId: candidateProfile.id,
      },
    });
  }

  const existingApplication = await prisma.applicationForJobOffer.findFirst({
    where: {
      candidateProfileId: candidateProfile.id,
      jobOfferId: frontendOffer.id,
    },
  });

  if (!existingApplication) {
    const application = await prisma.applicationForJobOffer.create({
      data: {
        message:
          "Cze≈õƒá! Mam du≈ºe do≈õwiadczenie w Next.js i budowaniu skalowalnych frontend√≥w. Chƒôtnie opowiem wiƒôcej podczas rozmowy.",
        status: ApplicationStatus.PENDING,
        candidateProfileId: candidateProfile.id,
        jobOfferId: frontendOffer.id,
        cvId: candidateCv.id,
      },
      include: { jobOffer: true },
    });

    const firstQuestion = await prisma.recruitmentQuestion.findFirst({
      where: { jobOfferId: frontendOffer.id },
    });

    if (firstQuestion) {
      await prisma.candidateAnswer.create({
        data: {
          applicationForJobOfferId: application.id,
          recruitmentQuestionId: firstQuestion.id,
          answer:
            "Przeprowadzi≈Çam audyt bundle'a, wprowadzi≈Çam code splitting i memoizacjƒô komponent√≥w. Efekt to -40% czasu ≈Çadowania.",
        },
      });
    }

    await prisma.meeting.create({
      data: {
        applicationForJobOfferId: application.id,
        dateTime: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
        type: MeetingType.ONLINE,
        contributors: "Anna Nowak, Piotr Kowalski",
        onlineMeetingUrl: "https://meet.jobonfire.com/frontend-interview",
        message: "Wstƒôpna rozmowa techniczna ‚Äì sprawdzenie dopasowania i do≈õwiadczenia.",
      },
    });
  }

  console.info("‚úÖ Seeding finished successfully.");
}

main()
  .catch((error: unknown) => {
    console.error("‚ùå Seeding failed:", error);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
